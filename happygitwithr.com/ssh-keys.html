<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Set up keys for SSH | Happy Git and GitHub for the useR</title>
<meta name="author" content="Jenny Bryan, the STAT 545 TAs, Jim Hester">
<meta name="description" content="When we interact with a remote Git server, such as GitHub, we have to include credentials in the request. This proves we are a specific GitHub user, who’s allowed to do whatever we’re asking to...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 10 Set up keys for SSH | Happy Git and GitHub for the useR">
<meta property="og:type" content="book">
<meta property="og:url" content="https://happygitwithr.com/ssh-keys.html">
<meta property="og:image" content="https://happygitwithr.com//img/watch-me-diff-watch-me-rebase-smaller.png">
<meta property="og:description" content="When we interact with a remote Git server, such as GitHub, we have to include credentials in the request. This proves we are a specific GitHub user, who’s allowed to do whatever we’re asking to...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Set up keys for SSH | Happy Git and GitHub for the useR">
<meta name="twitter:site" content="@jennybryan">
<meta name="twitter:description" content="When we interact with a remote Git server, such as GitHub, we have to include credentials in the request. This proves we are a specific GitHub user, who’s allowed to do whatever we’re asking to...">
<meta name="twitter:image" content="https://happygitwithr.com//img/watch-me-diff-watch-me-rebase-smaller.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-131856976-1"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-131856976-1');
  </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="ssh-keys.html#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Happy Git and GitHub for the useR</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Let’s Git started</a></li>
<li><a class="" href="big-picture.html"><span class="header-section-number">1</span> Why Git? Why GitHub?</a></li>
<li><a class="" href="contrib.html"><span class="header-section-number">2</span> Contributors</a></li>
<li><a class="" href="workshops.html"><span class="header-section-number">3</span> Workshops</a></li>
<li class="book-part">Installation</li>
<li><a class="" href="install-intro.html">Half the battle</a></li>
<li><a class="" href="github-acct.html"><span class="header-section-number">4</span> Register a GitHub account</a></li>
<li><a class="" href="install-r-rstudio.html"><span class="header-section-number">5</span> Install or upgrade R and RStudio</a></li>
<li><a class="" href="install-git.html"><span class="header-section-number">6</span> Install Git</a></li>
<li><a class="" href="hello-git.html"><span class="header-section-number">7</span> Introduce yourself to Git</a></li>
<li><a class="" href="git-client.html"><span class="header-section-number">8</span> Install a Git client</a></li>
<li class="book-part">Connect Git, GitHub, RStudio</li>
<li><a class="" href="connect-intro.html">Can you hear me now?</a></li>
<li><a class="" href="https-pat.html"><span class="header-section-number">9</span> Personal access token for HTTPS</a></li>
<li><a class="active" href="ssh-keys.html"><span class="header-section-number">10</span> Set up keys for SSH</a></li>
<li><a class="" href="push-pull-github.html"><span class="header-section-number">11</span> Connect to GitHub</a></li>
<li><a class="" href="rstudio-git-github.html"><span class="header-section-number">12</span> Connect RStudio to Git and GitHub</a></li>
<li><a class="" href="rstudio-see-git.html"><span class="header-section-number">13</span> Detect Git from RStudio</a></li>
<li><a class="" href="troubleshooting.html"><span class="header-section-number">14</span> RStudio, Git, GitHub Hell</a></li>
<li class="book-part">Early GitHub Wins</li>
<li><a class="" href="usage-intro.html">Get started with GitHub</a></li>
<li><a class="" href="new-github-first.html"><span class="header-section-number">15</span> New project, GitHub first</a></li>
<li><a class="" href="existing-github-first.html"><span class="header-section-number">16</span> Existing project, GitHub first</a></li>
<li><a class="" href="existing-github-last.html"><span class="header-section-number">17</span> Existing project, GitHub last</a></li>
<li><a class="" href="rmd-test-drive.html"><span class="header-section-number">18</span> Test drive R Markdown</a></li>
<li><a class="" href="r-test-drive.html"><span class="header-section-number">19</span> Render an R script</a></li>
<li class="book-part">Git fundamentals</li>
<li><a class="" href="git-intro.html">Some Git basics</a></li>
<li><a class="" href="git-basics.html"><span class="header-section-number">20</span> Repo, commit, diff, tag</a></li>
<li><a class="" href="git-commands.html"><span class="header-section-number">21</span> Git commands</a></li>
<li><a class="" href="git-branches.html"><span class="header-section-number">22</span> Branches</a></li>
<li><a class="" href="git-remotes.html"><span class="header-section-number">23</span> Remotes</a></li>
<li class="book-part">Remote setups</li>
<li><a class="" href="remote-scenarios-intro.html">Git remote setups</a></li>
<li><a class="" href="common-remote-setups.html"><span class="header-section-number">24</span> Common remote setups</a></li>
<li><a class="" href="equivocal.html"><span class="header-section-number">25</span> Equivocal remote setups</a></li>
<li class="book-part">Daily Workflows</li>
<li><a class="" href="workflows-intro.html">Useful Git patterns for real life</a></li>
<li><a class="" href="repeated-amend.html"><span class="header-section-number">26</span> The Repeated Amend</a></li>
<li><a class="" href="push-rejected.html"><span class="header-section-number">27</span> Dealing with push rejection</a></li>
<li><a class="" href="pull-tricky.html"><span class="header-section-number">28</span> Pull, but you have local work</a></li>
<li><a class="" href="time-travel-see-past.html"><span class="header-section-number">29</span> Time travel: See the past</a></li>
<li><a class="" href="fork-and-clone.html"><span class="header-section-number">30</span> Fork and clone</a></li>
<li><a class="" href="upstream-changes.html"><span class="header-section-number">31</span> Get upstream changes for a fork</a></li>
<li><a class="" href="pr-extend.html"><span class="header-section-number">32</span> Explore and extend a pull request</a></li>
<li><a class="" href="workflows-browsability.html"><span class="header-section-number">33</span> Make a GitHub repo browsable</a></li>
<li class="book-part">Activity prompts</li>
<li><a class="" href="clone.html"><span class="header-section-number">34</span> Clone a repo</a></li>
<li><a class="" href="bingo.html"><span class="header-section-number">35</span> Create a bingo card</a></li>
<li><a class="" href="burn.html"><span class="header-section-number">36</span> Burn it all down</a></li>
<li><a class="" href="reset.html"><span class="header-section-number">37</span> Resetting</a></li>
<li><a class="" href="search.html"><span class="header-section-number">38</span> Search GitHub</a></li>
<li class="book-part">Notes</li>
<li><a class="" href="notes-intro.html">Notes</a></li>
<li><a class="" href="classroom-overview.html"><span class="header-section-number">39</span> Run a course with GitHub</a></li>
<li><a class="" href="ideas-for-content.html"><span class="header-section-number">40</span> Ideas for content</a></li>
<li><a class="" href="bookdown-cheat-sheet.html"><span class="header-section-number">41</span> Bookdown cheat sheet</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="shell.html"><span class="header-section-number">A</span> The shell</a></li>
<li><a class="" href="comic-relief.html"><span class="header-section-number">B</span> Comic relief</a></li>
<li><a class="" href="resources.html"><span class="header-section-number">C</span> Resources</a></li>
<li><a class="" href="references.html"><span class="header-section-number">D</span> References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jennybc/happy-git-with-r">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ssh-keys" class="section level1">
<h1>
<span class="header-section-number">10</span> Set up keys for SSH<a class="anchor" aria-label="anchor" href="ssh-keys.html#ssh-keys"><i class="fas fa-link"></i></a>
</h1>
<p>When we interact with a remote Git server, such as GitHub, we have to include credentials in the request.
This proves we are a specific GitHub user, who’s allowed to do whatever we’re asking to do.</p>
<p>Git can communicate with a remote server using one of two protocols, HTTPS or SSH, and the different protocols use different credentials.</p>
<p>Here we describe the credential setup for the SSH protocol.
If you’re not sure whether to use HTTPS or SSH, please read <a href="https-pat.html#https-vs-ssh">HTTPS versus SSH</a>.
From now on, we assume you’ve made an intentional choice to set up SSH keys.</p>
<div id="ssh-keys-1" class="section level2">
<h2>
<span class="header-section-number">10.1</span> SSH keys<a class="anchor" aria-label="anchor" href="ssh-keys.html#ssh-keys-1"><i class="fas fa-link"></i></a>
</h2>
<p>SSH keys provide a more secure way of logging into a server than using a password alone. While a password can eventually be cracked with a brute force attack, SSH keys are nearly impossible to decipher by brute force alone. Generating a key pair provides you with two long strings of characters: a public and a private key. You can place the public key on any server (like GitHub!), and then unlock it by connecting to it with a client that already has the private key (your computer!). When the two match up, the system unlocks without the need for a password. You can increase security even more by protecting the private key with a passphrase.</p>
<p>Adapted from instructions provided by <a href="https://help.github.com/categories/ssh/">GitHub</a> and <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2">Digital Ocean</a>.</p>
</div>
<div id="ssh-outline-and-advice" class="section level2">
<h2>
<span class="header-section-number">10.2</span> SSH outline and advice<a class="anchor" aria-label="anchor" href="ssh-keys.html#ssh-outline-and-advice"><i class="fas fa-link"></i></a>
</h2>
<p>High level overview of what must happen:</p>
<ul>
<li>Create a public-private SSH key pair. Literally, 2 special files, in a special place. Optionally, encrypt the private key with a passphrase (best practice).</li>
<li>Add the private key to your ssh-agent. If you protected it with a passphrase, you may have additional configuration.</li>
<li>Add your public key to your GitHub profile.</li>
</ul>
<p>Advice:</p>
<ul>
<li>If you are new to programming and the shell, you’ll probably find HTTPS easier at first (chapter <a href="https-pat.html#https-pat">9</a>). You can always switch to SSH later. You can use one method from computer A and the other from computer B.</li>
<li>You should swap out your SSH keys periodically. Something like once a year.</li>
<li>It’s best practice to protect your private key with a passphrase. This can make setup and usage harder, so if you’re not up for that (yet), either don’t use a passphrase or seriously consider using HTTPS instead.</li>
<li>Don’t do weird gymnastics in order to have only one key pair, re-used over multiple computers. You should probably have one key per computer (I do this). Some people even have one key per computer, per service (I do not do this).</li>
<li>It is normal to associate multiple public keys with your GitHub account. For example, one public key for each computer you connect with.</li>
</ul>
</div>
<div id="do-you-already-have-keys" class="section level2">
<h2>
<span class="header-section-number">10.3</span> Do you already have keys?<a class="anchor" aria-label="anchor" href="ssh-keys.html#do-you-already-have-keys"><i class="fas fa-link"></i></a>
</h2>
<p>You can check this from RStudio or from the shell.</p>
<p>Global advice: if you do have existing keys, but have no clue where they came from or why you created them, you should seriously consider creating a new SSH key pair. It’s up to you to figure out whether/how to delete the old ones. But don’t let that keep you from creating new keys and moving forward.</p>
<div id="from-rstudio" class="section level3">
<h3>
<span class="header-section-number">10.3.1</span> From RStudio<a class="anchor" aria-label="anchor" href="ssh-keys.html#from-rstudio"><i class="fas fa-link"></i></a>
</h3>
<p>Go to <em>Tools &gt; Global Options…&gt; Git/SVN</em>. If you see something like <code>~/.ssh/id_rsa</code> in the SSH RSA Key box, you definitely have existing keys.</p>
<p>Caveat: RStudio only looks for a key pair named <code>id_rsa</code> and <code>id_rsa.pub</code>.
This makes sense, because historically that has been the most common.</p>
<p>However, these days both GitHub and GitLab are encouraging users to generate SSH keys with the Ed25519 algorithm, which results in a key pair named <code>id_ed25519</code> and <code>id_ed25519.pub</code>.
At the time of writing, RStudio will not display such a key pair, which can be confusing.
Therefore, it’s probably a good idea to also check for existing keys in the shell.</p>
</div>
<div id="from-the-shell" class="section level3">
<h3>
<span class="header-section-number">10.3.2</span> From the shell<a class="anchor" aria-label="anchor" href="ssh-keys.html#from-the-shell"><i class="fas fa-link"></i></a>
</h3>
<p>Go to the shell (appendix <a href="shell.html#shell">A</a>).</p>
<p>List existing keys:</p>
<pre class="console"><code>ls -al ~/.ssh/</code></pre>
<p>If you are told <code>~/.ssh/</code> doesn’t exist, you don’t have SSH keys!</p>
<p>If you see a pair of files like <code>id_rsa.pub</code> and <code>id_rsa</code> or <code>id_ed25519</code> and <code>id_ed25519.pub</code>, you have a key pair already.
The typical pattern is <code>id_FOO.pub</code> (the public key) and <code>id_FOO</code> (the private key), where <code>FOO</code> reflects the key type.
If you’re happy to stick with your existing keys, skip to the sections about adding a key to the ssh-agent and GitHub.</p>
</div>
</div>
<div id="create-an-ssh-key-pair" class="section level2">
<h2>
<span class="header-section-number">10.4</span> Create an SSH key pair<a class="anchor" aria-label="anchor" href="ssh-keys.html#create-an-ssh-key-pair"><i class="fas fa-link"></i></a>
</h2>
<div id="option-1-set-up-from-rstudio" class="section level3">
<h3>
<span class="header-section-number">10.4.1</span> Option 1: Set up from RStudio<a class="anchor" aria-label="anchor" href="ssh-keys.html#option-1-set-up-from-rstudio"><i class="fas fa-link"></i></a>
</h3>
<p>Go to <em>Tools &gt; Global Options…&gt; Git/SVN &gt; Create RSA Key…</em>.</p>
<p>RStudio prompts you for a passphrase. It is optional, but also a best practice. Configuring your system for smooth operation with a passphrase-protected key introduces more moving parts.
If you’re completely new at all this, skip the passphrase (or use HTTPS!) and implement it next time, when you are more comfortable with system configuration.
I did not use a passphrase at first, but I do now, and record it in a password manager.</p>
<p>Click “Create” and RStudio will generate an SSH key pair, stored in the files <code>~/.ssh/id_rsa</code> and <code>~/.ssh/id_rsa.pub</code>.</p>
<p>Note that RStudio currently only generates RSA keys, whereas the standard recommendation by GitHub and GitLab is to use Ed25519 keys.
If you want to comply with that advice, generate your keys in the shell for now.</p>
</div>
<div id="option-2-set-up-from-the-shell" class="section level3">
<h3>
<span class="header-section-number">10.4.2</span> Option 2: Set up from the shell<a class="anchor" aria-label="anchor" href="ssh-keys.html#option-2-set-up-from-the-shell"><i class="fas fa-link"></i></a>
</h3>
<p>Create the key pair like so, but substitute a comment that means something to you, especially if you’ll have multiple SSH keys in your life.
Consider the email associated with your GitHub account or the name of your computer or some combination, e.g. <code>your_email@example.com</code> or <code>macbook-pro</code> or <code>jane-2020-macbook-pro</code>.</p>
<pre class="console"><code>ssh-keygen -t ed25519 -C "DESCRIPTIVE-COMMENT"</code></pre>
<p>If it appears that your system is too old to support the Ed25519 algorithm, do this instead:</p>
<pre class="console"><code>ssh-keygen -t rsa -b 4096 -C "DESCRIPTIVE-COMMENT"</code></pre>
<p>Accept the proposal to save the key in the default location.
Just press Enter here:</p>
<pre class="console"><code>Enter file in which to save the key (/Users/jenny/.ssh/id_ed25519):</code></pre>
<p>You have the option to protect the key with a passphrase.
It is optional, but also a best practice.
Configuring your system for smooth operation with a passphrase-protected key introduces more moving parts.
If you’re completely new at all this, skip the passphrase and implement it next time, when you are more comfortable with system configuration.
I did not use a passphrase at first, but I do now, and record it in a password manager.</p>
<pre class="console"><code>Enter passphrase (empty for no passphrase):
Enter same passphrase again: </code></pre>
<p>The process should complete now and should have looked like this:</p>
<pre class="console"><code>~ % ssh-keygen -t ed25519 -C "jenny-2020-mbp"        
Generating public/private ed25519 key pair.
Enter file in which to save the key (/Users/jenny/.ssh/id_ed25519): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /Users/jenny/.ssh/id_ed25519.
Your public key has been saved in /Users/jenny/.ssh/id_ed25519.pub.
The key fingerprint is:
SHA256:XUEaY/elhcQJz3M9jx/SdC0zh10lCA7uNpqgkm5G/R0 jenny-2020-mbp
The key's randomart image is:
+--[ED25519 256]--+
|        . =o==oo*|
|       . + =.=+B+|
|        . o . @oB|
|       . . .  oO+|
|  . .   S .  ..o.|
| o o . E .    ...|
|+ . . + .       .|
|.+   . .         |
|o.               |
+----[SHA256]-----+</code></pre>
</div>
<div id="add-key-to-ssh-agent" class="section level3">
<h3>
<span class="header-section-number">10.4.3</span> Add key to ssh-agent<a class="anchor" aria-label="anchor" href="ssh-keys.html#add-key-to-ssh-agent"><i class="fas fa-link"></i></a>
</h3>
<p>Tell your ssh-agent about the key and, especially, set it up to manage the passphrase, if you chose to set one.</p>
<p>Things get a little OS-specific around here.
When in doubt, consult <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh">GitHub’s instructions for SSH</a>, which is kept current for Mac, Windows, and Linux.
It also accounts for more unusual situations than I can.</p>
<div id="mac-os" class="section level4">
<h4>
<span class="header-section-number">10.4.3.1</span> Mac OS<a class="anchor" aria-label="anchor" href="ssh-keys.html#mac-os"><i class="fas fa-link"></i></a>
</h4>
<p>Make sure ssh-agent is enabled. Here’s what success look like (the <code>pid</code> will vary):</p>
<pre class="console"><code>~ % eval "$(ssh-agent -s)"
Agent pid 15360</code></pre>
<p>Sometimes this fails like so:</p>
<pre class="console"><code>~ % eval "$(ssh-agent -s)"
mkdtemp: private socket dir: No such file or directory</code></pre>
<p>A similar failure might be reported as “Permission denied”.
You should try again, but as the superuser.
Don’t forget to use <code>exit</code> to go back to your normal user account, when you are done!</p>
<pre class="console"><code>~ % sudo su
Password:
sh-3.2# eval "$(ssh-agent -s)"
Agent pid 15385
sh-3.2# exit
exit</code></pre>
<p>Add your key to the ssh agent.
If you set a passphrase, you’ll be challenged for it here.
Give it.
The <code>-K</code> option stores your passphrase in the keychain.</p>
<pre class="console"><code>~ % ssh-add -K ~/.ssh/id_ed25519
Enter passphrase for /Users/jenny/.ssh/id_ed25519: 
Identity added: /Users/jenny/.ssh/id_ed25519 (jenny-2020-mbp)</code></pre>
<p>If you’re on macOS Sierra 10.12.2 and higher, you need to do one more thing.
Create a file <code>~/.ssh/config</code> with these contents:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="ssh-keys.html#cb47-1"></a><span class="ex">Host</span> *</span>
<span id="cb47-2"><a href="ssh-keys.html#cb47-2"></a>  <span class="ex">AddKeysToAgent</span> yes</span>
<span id="cb47-3"><a href="ssh-keys.html#cb47-3"></a>  <span class="ex">UseKeychain</span> yes</span>
<span id="cb47-4"><a href="ssh-keys.html#cb47-4"></a>  <span class="ex">IdentityFile</span> ~/.ssh/id_ed25519</span></code></pre></div>
<p>You can omit the line about <code>UseKeychain</code> if you didn’t use a passphrase.
But if you did, this should store your passphrase <em>persistently</em> in the keychain.
Otherwise, you will have to enter it every time you log in.
Useful StackOverflow thread: <a href="https://apple.stackexchange.com/questions/48502/how-can-i-permanently-add-my-ssh-private-key-to-keychain-so-it-is-automatically">How can I permanently add my SSH private key to Keychain so it is automatically available to ssh?</a>.</p>
</div>
<div id="windows" class="section level4">
<h4>
<span class="header-section-number">10.4.3.2</span> Windows<a class="anchor" aria-label="anchor" href="ssh-keys.html#windows"><i class="fas fa-link"></i></a>
</h4>
<p>In a Git Bash shell, make sure ssh-agent is running:</p>
<pre class="console"><code>$ eval $(ssh-agent -s)
Agent pid 59566</code></pre>
<p>Add your key, substituting the correct name for your key.</p>
<pre class="console"><code>$ ssh-add ~/.ssh/id_ed25519</code></pre>
</div>
<div id="linux-1" class="section level4">
<h4>
<span class="header-section-number">10.4.3.3</span> Linux<a class="anchor" aria-label="anchor" href="ssh-keys.html#linux-1"><i class="fas fa-link"></i></a>
</h4>
<p>In a shell, make sure ssh-agent is running:</p>
<pre class="console"><code>$ eval "$(ssh-agent -s)"
Agent pid 59566</code></pre>
<p>Add your key, substituting the correct name for your key.</p>
<pre class="console"><code>ssh-add ~/.ssh/id_ed25519</code></pre>
</div>
</div>
</div>
<div id="provide-public-key-to-github" class="section level2">
<h2>
<span class="header-section-number">10.5</span> Provide public key to GitHub<a class="anchor" aria-label="anchor" href="ssh-keys.html#provide-public-key-to-github"><i class="fas fa-link"></i></a>
</h2>
<p>Now we store a copy of your public key on GitHub.</p>
<div id="rstudio-to-clipboard" class="section level3">
<h3>
<span class="header-section-number">10.5.1</span> RStudio to clipboard<a class="anchor" aria-label="anchor" href="ssh-keys.html#rstudio-to-clipboard"><i class="fas fa-link"></i></a>
</h3>
<p>Go to <em>Tools &gt; Global Options…&gt; Git/SVN</em>.
If your key pair is named like <code>id_rsa.pub</code> and <code>id_rsa</code>, RStudio will see it and offer to “View public key”.
Do that and accept the offer to copy to your clipboard.</p>
<p>If your key pair is named differently, such as <code>id_ed25519.pub</code> and <code>id_ed25519</code>, you’ll have to copy the public key another way.</p>
</div>
<div id="shell-to-clipboard" class="section level3">
<h3>
<span class="header-section-number">10.5.2</span> Shell to clipboard<a class="anchor" aria-label="anchor" href="ssh-keys.html#shell-to-clipboard"><i class="fas fa-link"></i></a>
</h3>
<p>Copy the public key onto your clipboard.
For example, open <code>~/.ssh/id_ed25519.pub</code> in an editor and copy the contents to your clipboard.
Or do one of the following at the command line:</p>
<ul>
<li>Mac OS: <code>pbcopy &lt; ~/.ssh/id_ed25519.pub</code>
</li>
<li>Windows: <code>clip &lt; ~/.ssh/id_ed25519.pub</code>
</li>
<li>Linux: <code>xclip -sel clip &lt; ~/.ssh/id_ed25519.pub</code>
</li>
</ul>
<p>Linux: if needed, install <code>xclip</code> via <code>apt-get</code> or <code>yum</code>. For example, <code>sudo apt-get install xclip</code>.</p>
</div>
<div id="on-github" class="section level3">
<h3>
<span class="header-section-number">10.5.3</span> On GitHub<a class="anchor" aria-label="anchor" href="ssh-keys.html#on-github"><i class="fas fa-link"></i></a>
</h3>
<p>Now we register the public key with GitHub.
Click on your profile pic in upper right corner and go to <em>Settings &gt; SSH and GPG keys</em>.
Click “New SSH key”.
Paste your public key in the “Key” box.
Give it an informative title, presumably repeating the descriptive comment you used above, during key creation.
Click “Add SSH key”.</p>
<p>In theory, we’re done!
You can use <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/testing-your-ssh-connection"><code>ssh -T git@github.com</code></a> to test your connection to GitHub.
If you’re not sure what to make of the output, see the link for details.
Of course, the best test is to work through the realistic usage examples elsewhere in this guide.</p>
</div>
</div>
<div id="ssh-troubleshooting" class="section level2">
<h2>
<span class="header-section-number">10.6</span> Troubleshooting<a class="anchor" aria-label="anchor" href="ssh-keys.html#ssh-troubleshooting"><i class="fas fa-link"></i></a>
</h2>
<div id="https-url-when-you-meant-to-use-ssh" class="section level3">
<h3>
<span class="header-section-number">10.6.1</span> HTTPS URL when you meant to use SSH<a class="anchor" aria-label="anchor" href="ssh-keys.html#https-url-when-you-meant-to-use-ssh"><i class="fas fa-link"></i></a>
</h3>
<p>If you think you have SSH set up correctly and yet you are still challenged for credentials, consider this: for the repo in question, have you possibly set up GitHub, probably called <code>origin</code>, as an HTTPS remote, instead of SSH?</p>
<p>How to see the remote URL(s) associated with the current repo in the shell:</p>
<pre class="console"><code>git remote -v</code></pre>
<p>An SSH remote will look like this:</p>
<pre class="console"><code>git@github.com:USERNAME/REPOSITORY.git</code></pre>
<p>whereas an HTTPS remote will look like this:</p>
<pre class="console"><code>https://github.com/USERNAME/REPOSITORY.git</code></pre>
<p>You can fix this with <code>git remote set-url</code>, which is demonstrated in <a href="https-pat.html#url-determines-protocol">URL determines the protocol</a>.</p>
</div>
<div id="git2r-or-some-other-tool-cant-find-ssh-keys-on-windows" class="section level3">
<h3>
<span class="header-section-number">10.6.2</span> git2r – or some other tool – can’t find SSH keys on Windows<a class="anchor" aria-label="anchor" href="ssh-keys.html#git2r-or-some-other-tool-cant-find-ssh-keys-on-windows"><i class="fas fa-link"></i></a>
</h3>
<p>Have you seen this error message?</p>
<pre class="console"><code>Error in .local(object, ...) : 
  Error in 'git2r_push': error authenticating: failed connecting agent</code></pre>
<p>We’ve seen it when working with Git/GitHub from R via the <a href="https://cran.r-project.org/web/packages/git2r/index.html">git2r</a> package.</p>
<p>The root cause is confusion about the location of <code>.ssh/</code> on Windows.
R’s idea of your home directory on Windows often differs from the default location of config files for Git and ssh, such as <code>.ssh/</code>.
On *nix systems, these generally coincide and there’s no problem.</p>
<p>Two important directories on Windows are the user’s HOME and USERPROFILE.
R usually associates <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> with HOME, but Git and ssh often consult USERPROFILE for their config files.
On my Windows 10 VM, I see:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html">normalizePath</a></span><span class="op">(</span><span class="st">"~"</span><span class="op">)</span>
<span class="co">#&gt; [1] "C:\\Users\\JennyVM\\Documents"</span>

<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HOME"</span>, <span class="st">"USERPROFILE"</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; $HOME</span>
<span class="co">#&gt; [1] "C:/Users/JennyVM/Documents"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $USERPROFILE</span>
<span class="co">#&gt; [1] "C:\\Users\\JennyVM"</span>

<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"USERPROFILE"</span><span class="op">)</span>,
  pattern <span class="op">=</span> <span class="st">"ssh|git"</span>,
  include.dirs <span class="op">=</span> <span class="cn">TRUE</span>,
  all.files <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="co">#&gt; [1] ".gitconfig" ".ssh"</span></code></pre></div>
<p>Two workarounds:</p>
<ul>
<li>
<p>Tell git2r explicitly where to find your public and private key and pass the resulting <code>cred</code> object to your git2r calls.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cred</span> <span class="op">&lt;-</span> <span class="fu">git2r</span><span class="fu">::</span><span class="fu">cred_ssh_key</span><span class="op">(</span>
  publickey <span class="op">=</span> <span class="st">"~/../.ssh/id_rsa.pub"</span>,
  privatekey <span class="op">=</span> <span class="st">"~/../.ssh/id_rsa"</span>
<span class="op">)</span></code></pre></div>
</li>
<li>
<p><a href="https://www.howtogeek.com/howto/16226/complete-guide-to-symbolic-links-symlinks-on-windows-or-linux/">Create a symbolic link</a> so that <code>.ssh/</code> in R’s home directory points to your actual <code>.ssh/</code> directory. Example contributed by Ian Lyttle on Windows 7 using Command Prompt:</p>
<pre class="console"><code>MKLINK /D "C:\Users\username\Documents\.ssh" "C:\Users\username\.ssh"</code></pre>
</li>
</ul>
<p>Finally, if git2r seems unable to get your SSH passphrase from ssh-agent, install the getPass package:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"getPass"</span><span class="op">)</span></code></pre></div>
<p>and git2r should launch a popup where you can enter your passphrase.
Thanks to Ian Lyttle for this tip.</p>
<p>This link provides a great explanation of the uncertainty about where <code>.ssh/</code> and user’s <code>.gitconfig</code> are located on Windows: <a href="https://www.onwebsecurity.com/configuration/git-on-windows-location-of-global-configuration-file.html">git on Windows - location of configuration files</a>.
Bottom line: place your config and keys where your main tool expects them to be and create symbolic links to help other tools find this stuff.</p>
</div>
<div id="other" class="section level3">
<h3>
<span class="header-section-number">10.6.3</span> Other<a class="anchor" aria-label="anchor" href="ssh-keys.html#other"><i class="fas fa-link"></i></a>
</h3>
<p>Other things to double-check:</p>
<ul>
<li>Did you add the SSH to your ssh-agent?</li>
<li>Did you configure Mac OS Sierra or High Sierra to persistently store your passphrase in the keychain?</li>
<li>Did you add the public key to GitHub?</li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="https-pat.html"><span class="header-section-number">9</span> Personal access token for HTTPS</a></div>
<div class="next"><a href="push-pull-github.html"><span class="header-section-number">11</span> Connect to GitHub</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="ssh-keys.html#ssh-keys"><span class="header-section-number">10</span> Set up keys for SSH</a></li>
<li><a class="nav-link" href="ssh-keys.html#ssh-keys-1"><span class="header-section-number">10.1</span> SSH keys</a></li>
<li><a class="nav-link" href="ssh-keys.html#ssh-outline-and-advice"><span class="header-section-number">10.2</span> SSH outline and advice</a></li>
<li>
<a class="nav-link" href="ssh-keys.html#do-you-already-have-keys"><span class="header-section-number">10.3</span> Do you already have keys?</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="ssh-keys.html#from-rstudio"><span class="header-section-number">10.3.1</span> From RStudio</a></li>
<li><a class="nav-link" href="ssh-keys.html#from-the-shell"><span class="header-section-number">10.3.2</span> From the shell</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="ssh-keys.html#create-an-ssh-key-pair"><span class="header-section-number">10.4</span> Create an SSH key pair</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="ssh-keys.html#option-1-set-up-from-rstudio"><span class="header-section-number">10.4.1</span> Option 1: Set up from RStudio</a></li>
<li><a class="nav-link" href="ssh-keys.html#option-2-set-up-from-the-shell"><span class="header-section-number">10.4.2</span> Option 2: Set up from the shell</a></li>
<li><a class="nav-link" href="ssh-keys.html#add-key-to-ssh-agent"><span class="header-section-number">10.4.3</span> Add key to ssh-agent</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="ssh-keys.html#provide-public-key-to-github"><span class="header-section-number">10.5</span> Provide public key to GitHub</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="ssh-keys.html#rstudio-to-clipboard"><span class="header-section-number">10.5.1</span> RStudio to clipboard</a></li>
<li><a class="nav-link" href="ssh-keys.html#shell-to-clipboard"><span class="header-section-number">10.5.2</span> Shell to clipboard</a></li>
<li><a class="nav-link" href="ssh-keys.html#on-github"><span class="header-section-number">10.5.3</span> On GitHub</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="ssh-keys.html#ssh-troubleshooting"><span class="header-section-number">10.6</span> Troubleshooting</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="ssh-keys.html#https-url-when-you-meant-to-use-ssh"><span class="header-section-number">10.6.1</span> HTTPS URL when you meant to use SSH</a></li>
<li><a class="nav-link" href="ssh-keys.html#git2r-or-some-other-tool-cant-find-ssh-keys-on-windows"><span class="header-section-number">10.6.2</span> git2r – or some other tool – can’t find SSH keys on Windows</a></li>
<li><a class="nav-link" href="ssh-keys.html#other"><span class="header-section-number">10.6.3</span> Other</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jennybc/happy-git-with-r/blob/master/connect-ssh-keys.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jennybc/happy-git-with-r/edit/master/connect-ssh-keys.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Happy Git and GitHub for the useR</strong>" was written by Jenny Bryan, the STAT 545 TAs, Jim Hester. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
